name: Update Marine Forecast

on:
  schedule:
    - cron: "0 */3 * * *"   # de 3 em 3 horas
  workflow_dispatch: # permite execução manual

jobs:
  update-json:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repositório
      uses: actions/checkout@v4

    - name: Configurar Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 20

    - name: Gerar forecast.json
      run: |
        mkdir -p docs
        cat <<EOF > docs/forecast.json
        {
          "generated_at": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
          "location": {
            "lat": 38.969,
            "lng": -9.42
          },
          "data": []
        }
        EOF
        echo "forecast.json gerado com sucesso."

    - name: Commit e push
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add docs/forecast.json
        git commit -m "Atualizar forecast.json em $(date -u +%Y-%m-%dT%H:%M:%SZ)" || echo "Nada para commitar"
        git push origin HEAD:main
